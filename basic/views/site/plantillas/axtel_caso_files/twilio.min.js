Twilio={extend:function(t){for(var x in t)Twilio[x]=t[x]}};
Twilio.extend(function(){var t={},x={},y=function(){function h(a){if(!(a in x)){var f={};t["lib/"+a+".js"].apply(f,[h,f]);x[a]=f}return x[a]}return h}();t["lib/twilio/connection.js"]=function(h,a){function f(a,m,q){if(!(this instanceof f))return new f(a,m,q);this.device=a;this.message=m||{};q=q||{};a={logPrefix:"[Connection]",bridgeToken:null,mediaStreamFactory:b.enabled()?e.PeerConnection:e.MediaStream,chunder:"chunder.prod.twilio.com",chunderw:"chunderw.prod.twilio.com",debug:!1,encrypt:!1,token:null,
secureSignaling:!0};for(var g in a)g in q||(q[g]=a[g]);this.options=q;this.parameters={};this._status=this.options.bridgeToken?"pending":"closed";c.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;d.mixinEventEmitter(this);this.mediaStream=this.options.mediaStreamFactory(b.enabled()?this.options.secureSignaling:this.options.encrypt,this.options[b.enabled()?"chunderw":"chunder"],this.device.options.simpleDialog);var p=this;this.mediaStream.onerror=function(a){var b={code:a.info.code,
message:a.info.message,info:a.info};p.log("Received an error from MediaStream:",a);p.fire("error",b)};this.mediaStream.onopen=function(){p._status="open";p.mediaStream.publish("input","live");p.mediaStream.attachAudio();p.mediaStream.play("output");p.fire("accept",p)};this.mediaStream.onclose=function(){p._status="closed";p.device.sounds.disconnect()&&p.device.soundcache.play("disconnect");p.fire("disconnect",p)}}var e=h("twilio/factories"),d=h("twilio/eventemitter"),c=h("twilio/log"),g=h("twilio/util"),
b=h("twilio/rtc");f.toString=function(){return"[Twilio.Connection class]"};f.prototype={toString:function(){return"[Twilio.Connection instance]"},sendDigits:function(a){if(a.match(/[^0-9*#w]/))throw new g.Exception("Illegal character passed into sendDigits");this.mediaStream.exec("sendDTMF",a);for(var b=[],q=0;q<a.length;q++){var d="w"!=a[q]?"dtmf"+a[q]:"";"dtmf*"==d&&(d="dtmfs");"dtmf#"==d&&(d="dtmfh");b.push([d,200,20])}this.device.soundcache.playseq(b)},status:function(){return this._status},mute:function(){this.mediaStream.detachAudio()},
unmute:function(){this.mediaStream.attachAudio()},accept:function(a){if("function"==typeof a)return this.addListener("accept",a);var b=this;e.getClass("vendor/mediastream/mediastream","MediaStream");this._status="pending";this.mediaStream.openHelper(function(a,d){if(a)b._die(a,d);else{var p=[],c;for(c in b.message)p.push(encodeURIComponent(c)+"="+encodeURIComponent(b.message[c]));p=[b.mediaStream.uri(),b.options.token,b.options.bridgeToken,p.join("&")].concat(b.options.acceptParams);b.mediaStream.open.apply(b.mediaStream,
p)}},this.device.options.simpleDialog,f.NO_MIC_LEVEL||0,function(){G.dialog.show()},function(a){b.device.showSettings(a)})},reject:function(a){if("function"==typeof a)return this.addListener("reject",a);this.device.stream.publish({Response:"reject",CallSid:this.parameters.CallSid},this.options.rejectChannel);this.fire("reject")},ignore:function(a){if("function"==typeof a)return this.addListener("cancel",a);this._status="closed";this.fire("cancel")},cancel:function(a){this.ignore(a)},disconnect:function(a){if("function"==
typeof a)return this.addListener("disconnect",a);"open"==this._status&&(this.log("Disconnecting..."),this.mediaStream.close())},error:function(a){if("function"==typeof a)return this.addListener("error",a)},_die:function(a,b){this.fire("error",{message:a,code:b})}};a.Connection=f};t["lib/twilio/device.js"]=function(h,a){function f(a,d){if(!(this instanceof f))return new f(a,d);if(!a)throw new k.Exception("Capability token is not valid or missing.");var p={logPrefix:"[Device]",host:"chunder.twilio.com",
chunderw:"chunderw.twilio.com",soundCacheFactory:c.SoundCache,soundFactory:c.Sound,connectionFactory:c.Connection,eventStreamFactory:c.EventStream,presenceFactory:c.Presence,eventsScheme:"wss",eventsHost:"matrix.twilio.com",noRegister:!1,encrypt:!1,simpleDialog:!1,rtc:!0,debug:!1,confirmOnClose:!1,secureSignaling:!0};d=d||{};for(var e in p)e in d||(d[e]=p[e]);this.options=d;this.token=a;this._status="offline";this.connections=[];this.sounds=new m({incoming:!0,outgoing:!0,disconnect:!0});this.options.rtc||
h("twilio/rtc").enabled(!1);this.soundcache=this.options.soundCacheFactory();p={incoming:"sounds/incoming.mp3",outgoing:"sounds/outgoing.mp3",disconnect:"sounds/disconnect.mp3",dtmf1:"sounds/dtmf-1.mp3",dtmf2:"sounds/dtmf-2.mp3",dtmf3:"sounds/dtmf-3.mp3",dtmf4:"sounds/dtmf-4.mp3",dtmf5:"sounds/dtmf-5.mp3",dtmf6:"sounds/dtmf-6.mp3",dtmf7:"sounds/dtmf-7.mp3",dtmf8:"sounds/dtmf-8.mp3",dtmf9:"sounds/dtmf-9.mp3",dtmf0:"sounds/dtmf-0.mp3",dtmfs:"sounds/dtmf-star.mp3",dtmfh:"sounds/dtmf-hash.mp3"};e="undefined"===
typeof B?"":B;for(var w in p){var r=this.options.soundFactory();r.load(e+p[w]);this.soundcache.add(w,r)}this.soundcache.envelope("incoming",{release:2E3});b.mixinLog(this,this.options.logPrefix);this.log.enabled=this.options.debug;g.mixinEventEmitter(this);var v=this;this.addListener("incoming",function(a){a.addListener("accept",function(){v.soundcache.stop("incoming")});a.addListener("cancel",function(){v.soundcache.stop("incoming")});a.addListener("error",function(){v.soundcache.stop("incoming")});
v.sounds.incoming()&&v.soundcache.play("incoming",0,1E3)});this.register(this.token);this.options.confirmOnClose&&(w=function(a){if("busy"==v._status)return(a||window.event).returnValue="A call is currently active."},window.addEventListener?window.addEventListener("beforeunload",w):window.attachEvent&&window.attachEvent("onbeforeunload",w))}function e(a,b,d,c,e){var g={acceptParams:[JSON.stringify(k.getSystemInfo()),k.objectize(a.token).iss],chunder:a.options.host,chunderw:a.options.chunderw,encrypt:a.options.encrypt,
debug:a.options.debug,secureSignaling:a.options.secureSignaling};e=e||{};for(var m in g)m in e||(e[m]=g[m]);"bridge"==d?(e.bridgeToken=b,e.token=null):"jwt"==d?(e.bridgeToken=null,e.token=b):this.log("Unknown token type: "+d);var f=a.options.connectionFactory(a,c,e);f.addListener("accept",function(){a._status="busy";a.fire("connect",f)});f.addListener("error",function(b){a.fire("error",b);if("pending"==f.status()){b=[].concat(a.connections);for(var d=0;d<b.length;d++)f==b[d]&&a.connections.splice(d,
1)}});f.addListener("cancel",function(){a.log("Canceled: "+f.parameters.CallSid);for(var b=[].concat(a.connections),d=0;d<b.length;d++)f==b[d]&&a.connections.splice(d,1);a.fire("cancel",f)});f.addListener("disconnect",function(){"busy"==a._status&&(a._status="ready");a.fire("disconnect",f);for(var b=[].concat(a.connections),d=0;d<b.length;d++)f==b[d]&&a.connections.splice(d,1)});return f}function d(a,b,d,c){c=c||[];for(var e=[],g=0;g<c.length;g++)e.push("feature="+c[g]);c=["AccessToken="+a].concat(e);
return[b+"://"+d,"2012-02-09",k.objectize(a).iss,k.objectize(a).scope["client:incoming"].params.clientName].join("/")+"?"+c.join("&")}var c=h("twilio/factories"),g=h("twilio/eventemitter"),b=h("twilio/log"),k=h("twilio/util"),m=h("twilio/options").Options;h("twilio/dialog");f.toString=function(){return"[Twilio.Device class]"};f.prototype={toString:function(){return"[Twilio.Device instance]"},register:function(a){var b=[],c=null;"client:incoming"in k.objectize(a).scope&&(b.push("incomingCalls"),b.push("publishPresence"),
this.presenceClient&&0<this.presenceClient.handlers.length&&b.push("presenceEvents"),c=d(a,this.options.eventsScheme,this.options.eventsHost,b));var g=this;!c||this.options.noRegister?(this.stream&&(this.stream.destroy(),this.presenceClient&&this.presenceClient.detach(this.stream),this.stream=null),this.log("Unable to receive incoming calls"),"offline"==g._status&&(g._status="ready"),setTimeout(function(){g.fire("ready",g)},0)):this.stream?(this.stream.options.url=c,this.stream.reconnect(a)):(this.log("Registering to stream with url: "+
c),this.stream=this.options.eventStreamFactory(a,{logPrefix:"[Matrix]",debug:this.options.debug,url:c}),this.stream.addListener("ready",function(){g.log("Stream is ready");"offline"==g._status&&(g._status="ready");g.fire("ready",g)}),this.stream.addListener("offline",function(){g.log("Stream is offline");g._status="offline";g.fire("offline",g)}),this.stream.addListener("error",function(a){g.log("Received error: ",a);g.fire("error",a)}),this.stream.addListener("incoming",function(a){g.log("Message incoming...",
a);switch(a.Request){case "invite":if("busy"==g._status){g.log("Device busy; ignoring incoming invite");break}if(!a.Token||!a.CallSid){g.fire("error",{message:"Malformed invite"});break}var b=a.Parameters||{};a=e(g,a.Token,"bridge",{},{rejectChannel:a.RejectChannel});a.parameters=b;g.connections.push(a);g.fire("incoming",a);break;case "cancel":for(var b=[].concat(g.connections),d=0;d<b.length;d++){var c=b[d];c.parameters.CallSid==a.CallSid&&"pending"==c.status()&&c.cancel()}}}),a=k.objectize(a).scope["client:incoming"].params.clientName,
this.presenceClient=this.options.presenceFactory(a,this,this.stream,{autoStart:!0}))},presence:function(a){"client:incoming"in k.objectize(this.token).scope&&(this.presenceClient.handlers.push(a),this.token&&1==this.presenceClient.handlers.length&&this.register(this.token))},showSettings:function(a){f.dialog.show(a);c.getClass("vendor/mediastream/mediastream","MediaStream").showSettings();f.dialog.screen.style.width="200%"},connect:function(a){if("function"==typeof a)return this.addListener("connect",
a);a=a||{};a=e(this,this.token,"jwt",a);this.connections.push(a);if(this.sounds.outgoing()){var b=this;a.accept(function(){b.soundcache.play("outgoing")})}a.accept();return a},disconnectAll:function(){for(var a=[].concat(this.connections),b=0;b<a.length;b++)a[b].disconnect();0<this.connections.length&&this.log("Connections left pending: "+this.connections.length)},destroy:function(){this.stream.destroy();this.swf&&this.swf.disconnect&&this.swf.disconnect()},disconnect:function(a){this.addListener("disconnect",
a)},incoming:function(a){this.addListener("incoming",a)},offline:function(a){this.addListener("offline",a)},ready:function(a){this.addListener("ready",a)},error:function(a){this.addListener("error",a)},status:function(){return this._status}};f=function(a){var b=[],d=[],c=function(b){if(a.instance)return b();d.push(b)},e=function(b){b=(b.code?b.code+": ":"")+b.message;a.instance&&a.instance.log(b);throw new k.Exception(b);},g={instance:null,setup:function(c,g){if(a.instance)a.instance.log("Found existing Device; using new token but ignoring options"),
a.instance.token=c,a.instance.register(c);else{a.instance=new f(c,g);a.sounds=a.instance.sounds;for(var k=0;k<d.length;k++)d[k]();a.error(e)}for(k=0;k<b.length;k++)b[k](c,g);b=[];return a},connect:function(b){if("function"==typeof b)c(function(){a.instance.addListener("connect",b)});else{if(!a.instance)throw new k.Exception("Run Twilio.Device.setup()");if(0<a.instance.connections.length)a.instance.fire("error",{message:"A connection is currently active"});else return a.instance.connect(b)}},disconnectAll:function(){c(function(){a.instance.disconnectAll()});
return a},disconnect:function(b){c(function(){a.instance.addListener("disconnect",b)});return a},status:function(){return a.instance._status},ready:function(b){c(function(){a.instance.addListener("ready",b)});return a},error:function(b){c(function(){b!=e&&a.instance.removeListener("error",e);a.instance.addListener("error",b)});return a},presence:function(b){c(function(){a.instance.presence(b)});return a},offline:function(b){c(function(){a.instance.addListener("offline",b)});return a},incoming:function(b){c(function(){a.instance.addListener("incoming",
b)});return a},destroy:function(){a.instance&&a.instance.destroy();return a},cancel:function(b){c(function(){a.instance.addListener("cancel",b)});return a},showPermissionsDialog:function(){if(!a.instance)throw new k.Exception("Run Twilio.Device.setup()");a.instance.showSettings()},__afterSetup:function(a){b.push(a)}},m;for(m in g)a[m]=g[m];return a}(f);f.dialog=c.Dialog();a.Device=f};t["lib/twilio/dialog.js"]=function(h,a){var f=function(){function a(){var d=document.createElement("div"),c=document.createElement("div"),
e=document.createElement("button");d.style.position="fixed";d.style.zIndex="99999";d.style.top="0";d.style.left="0";d.style.width="1px";d.style.height="1px";d.style.overflow="hidden";d.style.visibility="hidden";c.style.margin="10% auto 0";c.style.width="215px";c.style.borderRadius="8px";c.style.backgroundColor="#f8f8f8";c.style.border="8px solid rgb(160, 160, 160)";var b=this,k=function(){b.hide();b.closeCb&&b.closeCb.call()};e.appendChild(document.createTextNode("Close"));window.addEventListener?
e.addEventListener("click",k,!1):e.attachEvent("onclick",k);d.appendChild(c);c.appendChild(e);this.screen=d;this.dialog=c;this.close=e;this.container=null;this.inserted=!1;this.embed=function(){};document.body?(document.body.appendChild(d),b.inserted=!0):(b=this,c=function(){document.body.appendChild(d);b.inserted=!0;b.embed()},window.addEventListener?window.addEventListener("load",c,!1):window.attachEvent("onload",c))}a.prototype={insert:function(a,c){if(this.container){if(this.container==a)return;
this.dialog.removeChild(this.container)}this.container=a;this.dialog.insertBefore(a,this.close);this.embed=c||this.embed();this.inserted&&this.embed()},show:function(a){this.closeCb=a;this.screen.style.width="100%";this.screen.style.height="auto";this.screen.style.visibility="visible";a=this.dialog.style.width.replace("px","")|0;var c=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;this.dialog.style.marginLeft=(((window.innerWidth||document.documentElement.clientWidth||
document.body.clientWidth)-a)/2|0)+"px";this.dialog.style.marginTop=(.1*c|0)+"px"},hide:function(){this.screen.style.width="1px";this.screen.style.height="1px";this.screen.style.visibility="hidden"}};return a}();a.Dialog=f};t["lib/twilio/eventemitter.js"]=function(h,a){function f(a,c,e){c=c||[];if(0==c.length)return-1;if(!e&&c.indexOf)return c.indexOf(a);for(e=0;e<c.length;e++)if(c[e]===a)return e;return-1}var e={addListener:function(a,c){if("function"!=typeof c)throw new (h("twilio/util").Exception)("Listener must be a function, not "+
typeof c);this.handlers[a]=this.handlers[a]||[];this.handlers[a].push(c);this.log('Registered listener for event type "'+a+'"');return this},hasListener:function(a,c){return-1!=f(c,this.handlers[a])},removeListener:function(a,c){var e=f(c,this.handlers[a]);-1<e&&(this.handlers[a].splice(e,1),this.log('Removed listener for event type "'+a+'"'));return this},fire:function(){var a=Array.prototype.slice.call(arguments,0),c=a.shift(),e=this.handlers[c]||[];this.log('Invoke listeners for event type "'+
c+'"');for(c=0;c<e.length;c++)e[c].apply(this,a)}};a.mixinEventEmitter=function(a){a.handlers=a.handlers||{};a.log=a.log||function(){};for(var c in e)a[c]||(a[c]=function(a,b){return function(){var c=Array.prototype.slice.call(arguments,0);return e[b].apply(a,c)}}(a,c))}};t["lib/twilio/eventstream.js"]=function(h,a){function f(a,c){if(!a.fire||!a.addListener)throw new b.Exception("Object is not event savvy");return function(){var b=Array.prototype.slice.call(arguments,0);if("function"==typeof b[0])return a.addListener(c,
b[0]);b.unshift(c);return a.fire.apply(a,b)}}function e(a,b){var c;c="string"!=typeof a?"":a.trim?a.trim():a.replace(/^\s+|\s+$/g,"");return 0==c.length?[]:c.split("\n")}function d(a,b){if(!(this instanceof d))return new d(a,b);var e={logPrefix:"[EventStream]",scheme:"wss",host:"stream.twilio.com",reconnect:!0,url:null,flashTimeout:5E3,filters:{},debug:!1};b=b||{};for(var k in e)k in b||(b[k]=e[k]);this.options=b;this.token=a||"";this.handlers={};this.status="offline";g.mixinLog(this,this.options.logPrefix);
this.log.enabled=this.options.debug;this.heartbeat=new m({interval:15});c.mixinEventEmitter(this);this._connect();e="incoming ready offline sms call twiml error".split(" ");for(k=0;k<e.length;k++)this[e[k]]=f(this,e[k]);var h=this;this.addListener("publish",function(a){h.fire("twiml",a)})}var c=h("twilio/eventemitter"),g=h("twilio/log"),b=h("twilio/util"),k=h("twilio/factories"),m=h("twilio/heartbeat").Heartbeat;d.initializingFlash=!1;d.initializeFlash=function(a){d.initializingFlash||(d.initializingFlash=
!0,window.WebSocket&&window.WebSocket.__initialize&&(J=a.options.swfLocation,window.WebSocket.__initialize(),a.log("Waiting "+a.options.flashTimeout+"ms for flash to initialize"),window.setTimeout(function(){window.WebSocket.__flash||a.log("WebSocket did not initialize")},a.options.flashTimeout)))};d.toString=function(){return"[Twilio.EventStream class]"};d.prototype={toString:function(){return"[Twilio.EventStream instance]"},destroy:function(){this.socket.close();this.options.reconnect=!1;return this},
publish:function(a,b){try{this.socket.send(JSON.stringify({"rt.message":"publish","rt.subchannel":b,"rt.payload":a}))}catch(c){this.log("Error while publishing to eventstream. Reconnecting socket."),this.socket&&this.socket.close(),this._tryReconnect()}},_cleanupSocket:function(a){if(a){var b=function(){};a.onopen=function(){a.close()};a.onmessage=b;a.onerror=b;a.onclose=b;2>a.readyState&&a.close()}},_connect:function(a){var b=this,c=this._extractUrl(),d=++a||1;if(c){var g=this.socket;this.log("Attempting to connect to "+
c+"...");try{this.socket=k.WebSocket(c)}catch(m){this.log("Connection to "+c+" failed: "+(m.message||""));return}this.socket.onopen=function(){b.log("Socket opened... sending ready signal");b._cleanupSocket(g);b.socket.send(JSON.stringify({"rt.message":"listen","rt.token":b.token}))};this.socket.onerror=function(a){a.data?b.fire("error",{message:a.data.message||"",code:a.data.code||""}):b.log("Received message event:",a)};this.socket.onmessage=function(a){b.heartbeat.beat();if("\n"!=a.data){a=e(a.data);
for(var k=0;k<a.length;k++){var g=JSON.parse(a[k]);if("ready"==g["rt.message"])"ready"!=b.status&&(b.status="ready",b.fire("ready",b));else{var m=g["rt.message"]||g.EventType;if("error"==m){var f=g.message||"";b.log("Connection to "+c+" failed: "+f);/^4/.test(g.code)?b.options.reconnect=!1:5>d?(f=50*Math.pow(2,d),f=30+Math.round(Math.random()*f),setTimeout(function(){b.socket&&b.socket.close();b._connect(d)},f)):b.fire("error",{message:"Connection to Twilio failed: "+f,code:g.code||""})}"incoming"!=
m&&b.fire("incoming",g);b.fire(m,g)}}}};this.socket.onclose=function(){b._cleanupSocket(g);"offline"!=b.status&&(b.log("Gone offline"),b.status="offline",b.fire("offline",b))};this.heartbeat.onsleep=function(){b.log("Connection heartbeat timed out.");b.socket&&b.socket.close();b._tryReconnect(5E3)}}else this.log("Nothing to do")},reconnect:function(a){this.socket&&(0==this.socket.readyState?(socket=this.socket,socket.onopen=function(){socket.close()}):this.socket.close());this.token=a;this.options.reconnect=
!0;this._tryReconnect()},_extractUrl:function(){if(this.options.url)return this.options.url;var a=b.objectize(this.token).scope;if(!("stream:subscribe"in a))return null;var a=a["stream:subscribe"],a=a.params&&a.params.path?a.params.path:"/",c=this.options.filters;c.AccessToken=this.token;return this.options.scheme+"://"+this.options.host+a+"?"+b.urlencode(c,!0)},_tryReconnect:function(a){(new Date).getTime();if(this.options.reconnect&&null!=this._extractUrl()){a=a||5E3;this._connect();var b=function(b){return function(){b._tryReconnect(2*
a)}}(this),c=function(e){return function(){switch(e.socket.readyState){case 0:window.setTimeout(c,1E3);break;case 1:break;default:window.setTimeout(b,a)}}}(this);window.setTimeout(c,5E3)}}};d=function(a){var b=[],c=function(c){if(a.instance)return c();b.push(c)},e={instance:null,status:"offline",setup:function(c,e){a.instance=new a(c,e);for(var d=0;d<b.length;d++)b[d]();a.ready(function(){a.status="ready"});a.offline(function(){a.status="offline"});return a},incoming:function(b){c(function(){a.instance.incoming(b)});
return a},ready:function(b){c(function(){a.instance.ready(b)});return a},offline:function(b){c(function(){a.instance.offline(b)});return a},sms:function(b){c(function(){a.instance.sms(b)});return a},call:function(b){c(function(){a.instance.call(b)});return a},twiml:function(b){c(function(){a.instance.twiml(b)});return a},error:function(b){c(function(){a.instance.error(b)});return a}},d;for(d in e)a[d]=e[d];return a}(d);a.EventStream=d};t["lib/twilio/factories.js"]=function(h,a){function f(a,c){if(!a.apply)return e(a,
c);var d=function(){};d.prototype=a.prototype;c=Array.prototype.slice.call(c,0);d=new d;try{var g=a.apply(d,c)}catch(f){return e(a,c)}return"object"===typeof g?g:d}function e(a,c){var d=c.length;if(0===d)return new a;if(1===d)return new a(c[0]);if(2===d)return new a(c[0],c[1]);if(3===d)return new a(c[0],c[1],c[2]);if(4===d)return new a(c[0],c[1],c[2],c[3])}function d(a,d,e){var q=a+"/"+d;e&&(g[q]=e);return function(){var e=c[q]||(g[q]?g[q]():h(a)[d]);return f(e,arguments)}}var c={},g={};a.registerClass=
function(a,d,e){c[a+"/"+d]=e};a.getClass=function(a,d){var e=a+"/"+d;return c[e]||(g[e]?g[e]():void 0)};a.Presence=d("twilio/presence","Presence");a.Device=d("twilio/device","Device");a.Dialog=d("twilio/dialog","Dialog");a.Connection=d("twilio/connection","Connection");a.EventStream=d("twilio/eventstream","EventStream");a.SoundCache=d("twilio/soundcache","SoundCache");a.PeerConnection=d("twilio/rtc","PeerConnection");a.MediaStream=d("vendor/swfobject","swfobject",function(){return C});a.Sound=d("vendor/sound/sound",
"Sound",function(){return Twilio.Sound});a.WebSocket=d("vendor/web-socket-js/websocket","WebSocket",function(){return WebSocket});a.MediaStream=d("vendor/mediastream/mediastream","MediaStream",function(){return Twilio.MediaStream})};t["lib/twilio/heartbeat.js"]=function(h,a){function f(a){if(!(this instanceof f))return new f(a);a=a||{};var d=function(){},d={interval:10,now:function(){return(new Date).getTime()},repeat:function(a,b){return setInterval(a,b)},stop:function(a,b){return clearInterval(a,
b)},onsleep:d,onwakeup:d},c;for(c in d)c in a||(a[c]=d[c]);this.interval=a.interval;this.lastbeat=0;this.pintvl=null;this.onsleep=a.onsleep;this.onwakeup=a.onwakeup;this.repeat=a.repeat;this.stop=a.stop;this.now=a.now}f.toString=function(){return"[Twilio.Heartbeat class]"};f.prototype={toString:function(){return"[Twilio.Heartbeat instance]"},beat:function(){this.lastbeat=this.now();if(this.sleeping()){if(this.onwakeup)this.onwakeup();var a=this;this.pintvl=this.repeat.call(null,function(){a.check()},
1E3*this.interval)}},check:function(){var a=this.now()-this.lastbeat;if(!this.sleeping()&&a>=1E3*this.interval){if(this.onsleep)this.onsleep();this.stop.call(null,this.pintvl);this.pintvl=null}},sleeping:function(){return null==this.pintvl}};a.Heartbeat=f};t["lib/twilio/log.js"]=function(h,a){a.mixinLog=function(a,e){function d(){if(d.enabled)for(var a=d.prefix?d.prefix+" ":"",e=0;e<arguments.length;e++){var b=arguments[e];d.handler("string"==typeof b?a+b:b)}}d.enabled=!0;d.prefix=e||"";d.defaultHandler=
function(a){window.console&&console.log(a)};d.handler=d.defaultHandler;a.log=d}};t["lib/twilio/options.js"]=function(h,a){var f=function(){function a(c,g){if(!(this instanceof a))return new a(c);this.__dict__={};c=c||{};g=g||{};for(var b in c)this[b]=d(this.__dict__,b),this[b](c[b]);for(b in g)this[b](g[b])}function d(a,d){return function(b){return"undefined"==typeof b?a[d]:a[d]=b}}return a}();a.Options=f};t["lib/twilio/presence.js"]=function(h,a){var f=h("twilio/util").Set,e=h("twilio/util").bind,
d=h("twilio/options").Options,c=h("twilio/state"),g=function(a,b){return a+a*(2*Math.random()+-1)*b},b=function(){function a(b,g,k,p){this.roster=new f;this.handlers=[];this.clientName=b;this.options=new d({autoStart:!1,interval:300,variation:.2,clearTimeout:function(a){return clearTimeout(a)},setTimeout:function(a,b){return setTimeout(a,b)}},p);this._boundPresence=e(this.handlePresence,this);this._boundRoster=e(this.handleRoster,this);g.addListener("offline",e(this.handleOffline,this));this.attach(k);
this._boundHeartbeat=e(this.heartbeat,this,k,{ttl:2*this.options.interval(),availability:"available",keepalive:!0});b=new c.StateM({stop:"start",start:"stop"},this);this.start=b.doStart;this.stop=b.doStop;this.options.autoStart()&&this.start()}a.prototype.enterStart=function(a,b){b={tid:null};var c=this;(function u(){var a=g(c.options.interval(),c.options.variation());b.tid=c.options.setTimeout()(function(){c._boundHeartbeat();u()},1E3*a)})();return b};a.prototype.enterStop=function(a,b){this.options.clearTimeout()(b.tid)};
a.prototype.heartbeat=function(a,b){a.publish(b,"presence")};a.prototype.attach=function(a){a.addListener("presence",this._boundPresence);a.addListener("roster",this._boundRoster)};a.prototype.detach=function(a){a.removeListener("presence",this._boundPresence);a.removeListener("roster",this._boundRoster)};a.prototype.removeFromRoster=function(a){this.roster.del(a);this.invoke(a,!1)};a.prototype.addToRoster=function(a){this.roster.put(a);this.invoke(a,!0)};a.prototype.handleOffline=function(){var a=
e(this.removeFromRoster,this);this.roster.map(a)};a.prototype.handlePresence=function(a){this[a.Available?"addToRoster":"removeFromRoster"](a.From)};a.prototype.handleRoster=function(a){for(var b=0;b<a.Roster.length;b++)this.addToRoster(a.Roster[b])};a.prototype.invoke=function(a,b){if(a!==this.clientName)for(var c={from:a,available:b},d=0;d<this.handlers.length;d++)this.handlers[d](c)};return a}();a.Presence=b};t["lib/twilio/rtc.js"]=function(h,a){function f(a){"function"===typeof MediaStreamTrack.prototype.stop?
("function"===typeof a.getAudioTracks?a.getAudioTracks():a.audioTracks).forEach(function(a){a.stop()}):a.stop()}var e=h("twilio/factories"),d=h("twilio/util"),c=function(a,c){var d=function(){};this.onclose=this.onerror=this.onopen=d;this.stream=this.sock=this.version=null;this._uri=(a?"wss://":"ws://")+c+"/signal";this.video=document.createElement("video");this.video.autoplay="autoplay";this.sendHangup=!0};c.prototype={uri:function(){return this._uri},openHelper:function(a){var d=this;c.getUserMedia({audio:!0},
function(c){d.stream=c;a()},function(c){c.code==c.PERMISSION_DENIED?a("User denied access to microphone.",31208):a("Error occurred while accessing microphone.",31201)})},_setupPeerConnection:function(){var a=c.protocol;a.create();a.pc.addStream(this.stream);var d=this;a.pc.onaddstream=function(a){d.video.src=webkitURL.createObjectURL(a.stream)};a.createOffer({audio:!0});return a},_setupChannel:function(a,c,g,f,h,p){try{var u=e.WebSocket(a)}catch(w){this.onerror({info:w.message});this.close();return}var r=
this;u.onopen=function(){r.version.pc.onopen=r.onopen;r.version.pc.onstatechange=function(a){if(r.version.pc&&"stable"==r.version.pc.readyState)r.onopen()};r.version.pc.onsignalingstatechange=function(a){if(r.version.pc&&"stable"==r.version.pc.signalingState)r.onopen()};u.send(JSON.stringify({type:"OFFER",sdp:r.version.getSDP(),twilio:{appsid:c?d.objectize(c).iss:null,token:c,bridgeToken:g,params:f,extras:[h,p]}}))};u.onmessage=function(a){if("\n"==a.data)u.send("\n");else if(a=JSON.parse(a.data),
"ANSWER"===a.type)r.version.processAnswer(a.sdp);else if("CANDIDATE"===a.type)r.version.processCandidate(a.candidate,a.label);else if("HANGUP"===a.type){if(a.error)r.onerror({info:{code:a.error.code,message:a.error}});r.sendHangup=!1;r.close()}};u.onclose=function(){r.sock&&r.close()};return u},open:function(a,c,d,e,g,p){this.sock||(this.version=this._setupPeerConnection(),this.sock=this._setupChannel(a,c,d,e,g,p))},exec:function(a){var c=[].slice.call(arguments,1);if("sendDTMF"===a){var d=c[0];d&&
d.length&&this.sock&&this.sock.send(JSON.stringify({type:"DTMF",dtmf:c[0]}))}},close:function(){this.version.pc&&(this.version.pc.close(),this.version.pc=null);this.sock&&(this.sendHangup&&this.sock.send(JSON.stringify({type:"HANGUP"})),this.sock.close(),this.sock=null);this.stream&&(f(this.stream),this.stream=null);this.video.src="";this.onclose()},play:function(){},publish:function(){},attachAudio:function(){this.stream&&(("function"===typeof this.stream.getAudioTracks?this.stream.getAudioTracks():
this.stream.audioTracks)[0].enabled=!0)},detachAudio:function(){this.stream&&(("function"===typeof this.stream.getAudioTracks?this.stream.getAudioTracks():this.stream.audioTracks)[0].enabled=!1)}};c.getUserMedia=function(a,c,d){"undefined"!=typeof navigator&&navigator.webkitGetUserMedia(a,c,d)};var g=function(){};g.prototype.create=function(){this.pc=new webkitRTCPeerConnection({iceServers:[]},{optional:[{DtlsSrtpKeyAgreement:!1}]})};g.prototype.createOffer=function(a){var c=this;this.pc.createOffer(function(a){c.pc.setLocalDescription(new RTCSessionDescription(a))},
function(a){},function(a){if("undefined"===typeof a)return null;var b={};"undefined"!==typeof webkitRTCPeerConnection?(b.mandatory={},"undefined"!==typeof a.audio&&(b.mandatory.OfferToReceiveAudio=a.audio),"undefined"!==typeof a.video&&(b.mandatory.OfferToReceiveVideo=a.video)):("undefined"!==typeof a.audio&&(b.offerToReceiveAudio=a.audio),"undefined"!==typeof a.video&&(b.offerToReceiveVideo=a.video));return b}(a))};g.prototype.getSDP=function(){return this.pc.localDescription.sdp};g.prototype.processAnswer=
function(a){this.pc.setRemoteDescription(new RTCSessionDescription({sdp:a,type:"answer"}))};g.prototype.processCandidate=function(a,c){return this.pc.addIceCandidate(new RTCIceCandidate({sdpMLineIndex:0,candidate:a}))};g.test=function(){return"object"==typeof navigator&&navigator.webkitGetUserMedia&&"function"==typeof webkitRTCPeerConnection};g=g.test()?new g:null;c.protocol=g;c.enabled=!!c.protocol;a.PeerConnection=c;a.enabled=function(a){"undefined"!==typeof a&&(c.enabled=a);return c.enabled}};
t["lib/twilio/soundcache.js"]=function(h,a){function f(a,c){return function(){var e=Array.prototype.slice(arguments);c.apply(a,e)}}function e(){if(!(this instanceof e))return new e;this.cache={}}e.prototype={add:function(a,c,e){e=e||{};if(!(e instanceof Object))throw new TypeError("Bad envelope type; expected Object");c instanceof Array||(c=[c]);this.cache[a]={starttime:null,sounds:c,envelope:e}},play:function(a,c,e){c=c||0;e=e||1;if(a in this.cache){a=this.cache[a];for(var b=0;b<a.sounds.length;b++)a.sounds[b].play(c,
e);a.starttime=(new Date).getTime()}},stop:function(a){if(a in this.cache){var c=this.cache[a];a=c.envelope.release||0;var e=function(){for(var a=0;a<c.sounds.length;a++)c.sounds[a].stop()},b=(new Date).getTime(),b=Math.max(0,a-(b-c.starttime));0==a?e():setTimeout(e,b)}},envelope:function(a,c){if(a in this.cache){var e=this.cache[a],b;for(b in c)e.envelope[b]=c[b]}},playseq:function(){var a=null,c=[],e=function(){var b=c.shift();if(b){var k=b[0],h=b[1]||0,b=b[2]||0;k in this.cache&&this.play(k);a=
setTimeout(f(this,e),h+b)}else a=null};return function(b){for(var k=0;k<b.length;k++)c.push(b[k]);null==a&&(a=setTimeout(f(this,e),0))}}()};a.SoundCache=e};t["lib/twilio/state.js"]=function(h,a){var f,e,d,c,g,b=function(a,b){function c(){this.constructor=a}for(var e in b)k.call(b,e)&&(a[e]=b[e]);c.prototype=b.prototype;a.prototype=new c;a.__super__=b.prototype;return a},k={}.hasOwnProperty,m=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},q=[].slice;
g=function(a){return a.substr(0,1).toUpperCase()+a.slice(1)};c=function(a){var b,c,d;c=[];for(b in a)d=a[b],c.push(new e(b,d));return c};d=function(a){function c(){c.__super__.constructor.apply(this,arguments)}b(c,a);return c}(Error);e=function(){return function(a,b,c){this.froms=a;this.to=b;this.name=c;this.froms instanceof Array||(this.froms=[this.froms]);this.name=this.name||"do"+g(this.to)}}();f=function(){function a(b,e,d){var g;this.ctx=null!=e?e:this;this.stateData=null!=d?d:[];g=c(b);if(0===
g.length)throw Error("Must initialize with at least one transition");this.state=g[0].froms[0];this.stateData instanceof Array||(this.stateData=[this.stateData]);b=0;for(e=g.length;b<e;b++)d=g[b],this.makeEvent(d)}a.prototype.makeEvent=function(a){return this[a.name]=function(b){return function(){var c;if(c=b.state,0>m.call(a.froms,c))throw new d("Not a valid transition");b.stateData=b.invoke.apply(b,["leave",b.state,a].concat(q.call(b.stateData)));b.stateData=b.invoke.apply(b,["enter",a.to,a].concat(q.call(b.stateData)));
return b.state=a.to}}(this)};a.prototype.invoke=function(){var a,b,c,e,d;b=arguments[0];e=arguments[1];d=arguments[2];a=4<=arguments.length?q.call(arguments,3):[];b+=g(e);return this.ctx[b]?(a=(c=this.ctx)[b].apply(c,[d].concat(q.call(a))),"undefined"===typeof a&&(a=[]),a instanceof Array?a:[a]):a};return a}();a.TransitionError=d;a.Transition=e;a.StateM=f};t["lib/twilio/util.js"]=function(h,a){function f(a){if(!(this instanceof f))return new f(a);this.message=a}function e(a){return function(){var b=
Array.prototype.slice.call(arguments,0);a.memo=a.memo||{};return a.memo[b]?a.memo[b]:a.memo[b]=a.apply(null,b)}}function d(a){a=a.split(".");if(3!=a.length)throw new f("Wrong number of segments");return m(a[1])}function c(a){if(""==a)return{};if(-1==a.indexOf("&")&&-1==a.indexOf("="))return a;a=a.split("&");for(var b={},e=0;e<a.length;e++){var d=a[e].split("=");b[decodeURIComponent(d[0])]=c(decodeURIComponent(d[1]))}return b}function g(a){try{return btoa(a)}catch(b){try{return(new Buffer(a)).toString("base64")}catch(c){return Twilio._phpjs_btoa(a)}}}
function b(a){try{return atob(a)}catch(b){try{return(new Buffer(a,"base64")).toString("ascii")}catch(c){return Twilio._phpjs_atob(a)}}}function k(a){var b=[],c;for(c in a){var e="object"==typeof a[c]?k(a[c]):a[c];b.push(encodeURIComponent(c)+"="+encodeURIComponent(e))}return b.join("&")}f.prototype.toString=function(){return"Twilio.Exception: "+this.message};var m=e(function(a){var c=a.length%4;0<c&&(a+=Array(4-c+1).join("="));a=a.replace(/-/g,"+").replace(/_/g,"/");a=b(a);return JSON.parse(a)}),
q=e(function(a){a=d(a);for(var b=0===a.scope.length?[]:a.scope.split(" "),e={},g=0;g<b.length;g++){var k;k=b[g].match(/^scope:(\w+):(\w+)\??(.*)$/);if(!k||4!=k.length)throw new f("Bad scope URI");k={service:k[1],privilege:k[2],params:c(k[3])};e[k.service+":"+k.privilege]=k}a.scope=e;return a}),I=function(){function a(){this.set={}}a.prototype.clear=function(){this.set={}};a.prototype.put=function(b){return this.set[b]=a.DUMMY};a.prototype.del=function(a){return delete this.set[a]};a.prototype.map=
function(a,b){var c=[],e;for(e in this.set)c.push(a.call(b,e));return c};a.DUMMY={};return a}();a.encodescope=function(a,b,c){a=["scope",a,b].join(":");b=!0;for(var e in c){b=!1;break}return b?a:a+"?"+k(c)};a.dummyToken=function(a){var b={iss:"AC1111111111111111111111111111111",exp:14E8},c;for(c in b)a[c]=a[c]||b[c];a=g(JSON.stringify(a));a=a.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");return["*",a,"*"].join(".")};a.Exception=f;a.decode=d;a.btoa=g;a.atob=b;a.objectize=q;a.urlencode=function(a,
b){var c=[];b=b||!1;for(var e in a)if(b&&a[e]instanceof Array)for(var d in a[e]){var g=a[e][d];c.push(encodeURIComponent(e)+"="+encodeURIComponent(g))}else g=a[e],c.push(encodeURIComponent(e)+"="+encodeURIComponent(g));return c.join("&")};a.Set=I;a.bind=function(a,b){var c=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return a.apply(b,c.concat(e))}};a.getSystemInfo=function(){var a=h("twilio/factories"),b=h("twilio/rtc"),a=a.getClass("vendor/swfobject",
"swfobject"),c="undefined"!=typeof navigator?navigator:{},c={p:"browser",v:"1.1",browser:{userAgent:c.userAgent||"unknown",platform:c.platform||"unknown"}};b.enabled()?c.plugin="rtc":(c.plugin="flash",c.flash={v:a.getFlashPlayerVersion()});return c}};t["lib/twilio.js"]=function(h,a){a.Device=h("twilio/device").Device;a.EventStream=h("twilio/eventstream").EventStream;a.Connection=h("twilio/connection").Connection;a.require=h};var B="undefined"!=typeof B?B:function(){for(var h=window.location.protocol||
"http:",a="//static.twilio.com/libs/twiliojs/1.0/",f=document.getElementsByTagName("script"),e=/(\w+:)?(\/\/.*)(twilio.min.js|twilio.js)/,d=0;d<f.length;d++){var c=f[d].src.match(e);if(c){h=c[1]||h;a=c[2];break}}return h+a}(),J=B+"WebSocket.swf";window&&(window.WEB_SOCKET_SWF_LOCATION=J);this.JSON||(JSON=function(){function h(a){return 10>a?"0"+a:a}function a(e,d){var c,g,b,k;c=/["\\\x00-\x1f\x7f-\x9f]/g;var h;switch(typeof e){case "string":return c.test(e)?'"'+e.replace(c,function(a){var b=f[a];
if(b)return b;b=a.charCodeAt();return"\\u00"+Math.floor(b/16).toString(16)+(b%16).toString(16)})+'"':'"'+e+'"';case "number":return isFinite(e)?String(e):"null";case "boolean":case "null":return String(e);case "object":if(!e)return"null";if("function"===typeof e.toJSON)return a(e.toJSON());c=[];if("number"===typeof e.length&&!e.propertyIsEnumerable("length")){k=e.length;for(g=0;g<k;g+=1)c.push(a(e[g],d)||"null");return"["+c.join(",")+"]"}if(d)for(k=d.length,g=0;g<k;g+=1)b=d[g],"string"===typeof b&&
(h=a(e[b],d))&&c.push(a(b)+":"+h);else for(b in e)"string"===typeof b&&(h=a(e[b],d))&&c.push(a(b)+":"+h);return"{"+c.join(",")+"}"}}Date.prototype.toJSON=function(){return this.getUTCFullYear()+"-"+h(this.getUTCMonth()+1)+"-"+h(this.getUTCDate())+"T"+h(this.getUTCHours())+":"+h(this.getUTCMinutes())+":"+h(this.getUTCSeconds())+"Z"};var f={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{stringify:a,parse:function(a,d){function c(a,e){var g,f;if(e&&"object"===typeof e)for(g in e)Object.prototype.hasOwnProperty.apply(e,
[g])&&(f=c(g,e[g]),void 0!==f&&(e[g]=f));return d(a,e)}var g;if(/^[\],:{}\s]*$/.test(a.replace(/\\./g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return g=eval("("+a+")"),"function"===typeof d?c("",g):g;throw new SyntaxError("parseJSON");}}}());var C=function(){function h(){if(!H){try{var a=n.getElementsByTagName("body")[0].appendChild(n.createElement("span"));a.parentNode.removeChild(a)}catch(b){return}H=!0;for(var a=x.length,
c=0;c<a;c++)x[c]()}}function a(a){H?a():x[x.length]=a}function f(a){if("undefined"!=typeof z.addEventListener)z.addEventListener("load",a,!1);else if("undefined"!=typeof n.addEventListener)n.addEventListener("load",a,!1);else if("undefined"!=typeof z.attachEvent)u(z,"onload",a);else if("function"==typeof z.onload){var b=z.onload;z.onload=function(){b();a()}}else z.onload=a}function e(){var a=n.getElementsByTagName("body")[0],b=n.createElement("object");b.setAttribute("type","application/x-shockwave-flash");
var c=a.appendChild(b);if(c){var e=0;(function(){if("undefined"!=typeof c.GetVariable){var g=c.GetVariable("$version");g&&(g=g.split(" ")[1].split(","),l.pv=[parseInt(g[0],10),parseInt(g[1],10),parseInt(g[2],10)])}else if(10>e){e++;setTimeout(arguments.callee,10);return}a.removeChild(b);c=null;d()})()}else d()}function d(){var a=F.length;if(0<a)for(var e=0;e<a;e++){var d=F[e].id,f=F[e].callbackFn,h={success:!1,id:d};if(0<l.pv[0]){var m=p(d);if(m)if(!w(F[e].swfVersion)||l.wk&&312>l.wk)if(F[e].expressInstall&&
g()){h={};h.data=F[e].expressInstall;h.width=m.getAttribute("width")||"0";h.height=m.getAttribute("height")||"0";m.getAttribute("class")&&(h.styleclass=m.getAttribute("class"));m.getAttribute("align")&&(h.align=m.getAttribute("align"));for(var q={},m=m.getElementsByTagName("param"),n=m.length,r=0;r<n;r++)"movie"!=m[r].getAttribute("name").toLowerCase()&&(q[m[r].getAttribute("name")]=m[r].getAttribute("value"));b(h,q,d,f)}else k(m),f&&f(h);else v(d,!0),f&&(h.success=!0,h.ref=c(d),f(h))}else v(d,!0),
f&&((d=c(d))&&"undefined"!=typeof d.SetVariable&&(h.success=!0,h.ref=d),f(h))}}function c(a){var b=null;(a=p(a))&&"OBJECT"==a.nodeName&&("undefined"!=typeof a.SetVariable?b=a:(a=a.getElementsByTagName("object")[0])&&(b=a));return b}function g(){return!N&&w("6.0.65")&&(l.win||l.mac)&&!(l.wk&&312>l.wk)}function b(a,b,c,e){N=!0;G=e||null;J={success:!1,id:c};var d=p(c);if(d){"OBJECT"==d.nodeName?(L=m(d),O=null):(L=d,O=c);a.id="SWFObjectExprInst";if("undefined"==typeof a.width||!/%$/.test(a.width)&&310>
parseInt(a.width,10))a.width="310";if("undefined"==typeof a.height||!/%$/.test(a.height)&&137>parseInt(a.height,10))a.height="137";n.title=n.title.slice(0,47)+" - Flash Player Installation";e=l.ie&&l.win?"ActiveX":"PlugIn";e="MMredirectURL="+z.location.toString().replace(/&/g,"%26")+"&MMplayerType="+e+"&MMdoctitle="+n.title;b.flashvars="undefined"!=typeof b.flashvars?b.flashvars+("&"+e):e;l.ie&&l.win&&4!=d.readyState&&(e=n.createElement("div"),c+="SWFObjectNew",e.setAttribute("id",c),d.parentNode.insertBefore(e,
d),d.style.display="none",function(){4==d.readyState?d.parentNode.removeChild(d):setTimeout(arguments.callee,10)}());q(a,b,c)}}function k(a){if(l.ie&&l.win&&4!=a.readyState){var b=n.createElement("div");a.parentNode.insertBefore(b,a);b.parentNode.replaceChild(m(a),b);a.style.display="none";(function(){4==a.readyState?a.parentNode.removeChild(a):setTimeout(arguments.callee,10)})()}else a.parentNode.replaceChild(m(a),a)}function m(a){var b=n.createElement("div");if(l.win&&l.ie)b.innerHTML=a.innerHTML;
else if(a=a.getElementsByTagName("object")[0])if(a=a.childNodes)for(var c=a.length,e=0;e<c;e++)1==a[e].nodeType&&"PARAM"==a[e].nodeName||8==a[e].nodeType||b.appendChild(a[e].cloneNode(!0));return b}function q(a,b,c){var e,d=p(c);if(l.wk&&312>l.wk)return e;if(d)if("undefined"==typeof a.id&&(a.id=c),l.ie&&l.win){var g="",f;for(f in a)a[f]!=Object.prototype[f]&&("data"==f.toLowerCase()?b.movie=a[f]:"styleclass"==f.toLowerCase()?g+=' class="'+a[f]+'"':"classid"!=f.toLowerCase()&&(g+=" "+f+'="'+a[f]+'"'));
f="";for(var k in b)b[k]!=Object.prototype[k]&&(f+='<param name="'+k+'" value="'+b[k]+'" />');d.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+g+">"+f+"</object>";y[y.length]=a.id;e=p(a.id)}else{k=n.createElement("object");k.setAttribute("type","application/x-shockwave-flash");for(var h in a)a[h]!=Object.prototype[h]&&("styleclass"==h.toLowerCase()?k.setAttribute("class",a[h]):"classid"!=h.toLowerCase()&&k.setAttribute(h,a[h]));for(g in b)b[g]!=Object.prototype[g]&&"movie"!=
g.toLowerCase()&&(a=k,f=g,h=b[g],c=n.createElement("param"),c.setAttribute("name",f),c.setAttribute("value",h),a.appendChild(c));d.parentNode.replaceChild(k,d);e=k}return e}function t(a){var b=p(a);b&&"OBJECT"==b.nodeName&&(l.ie&&l.win?(b.style.display="none",function(){if(4==b.readyState){var c=p(a);if(c){for(var e in c)"function"==typeof c[e]&&(c[e]=null);c.parentNode.removeChild(c)}}else setTimeout(arguments.callee,10)}()):b.parentNode.removeChild(b))}function p(a){var b=null;try{b=n.getElementById(a)}catch(c){}return b}
function u(a,b,c){a.attachEvent(b,c);K[K.length]=[a,b,c]}function w(a){var b=l.pv;a=a.split(".");a[0]=parseInt(a[0],10);a[1]=parseInt(a[1],10)||0;a[2]=parseInt(a[2],10)||0;return b[0]>a[0]||b[0]==a[0]&&b[1]>a[1]||b[0]==a[0]&&b[1]==a[1]&&b[2]>=a[2]?!0:!1}function r(a,b,c,e){if(!l.ie||!l.mac){var d=n.getElementsByTagName("head")[0];d&&(c=c&&"string"==typeof c?c:"screen",e&&(P=D=null),D&&P==c||(e=n.createElement("style"),e.setAttribute("type","text/css"),e.setAttribute("media",c),D=d.appendChild(e),
l.ie&&l.win&&"undefined"!=typeof n.styleSheets&&0<n.styleSheets.length&&(D=n.styleSheets[n.styleSheets.length-1]),P=c),l.ie&&l.win?D&&"object"==typeof D.addRule&&D.addRule(a,b):D&&"undefined"!=typeof n.createTextNode&&D.appendChild(n.createTextNode(a+" {"+b+"}")))}}function v(a,b){if(M){var c=b?"visible":"hidden";H&&p(a)?p(a).style.visibility=c:r("#"+a,"visibility:"+c)}}function A(a){return null!=/[\\\"<>\.;]/.exec(a)&&"undefined"!=typeof encodeURIComponent?encodeURIComponent(a):a}var z=window,n=
document,E=navigator,B=!1,x=[function(){B?e():d()}],F=[],y=[],K=[],L,O,G,J,H=!1,N=!1,D,P,M=!0,l=function(){var a="undefined"!=typeof n.getElementById&&"undefined"!=typeof n.getElementsByTagName&&"undefined"!=typeof n.createElement,b=E.userAgent.toLowerCase(),c=E.platform.toLowerCase(),e=c?/win/.test(c):/win/.test(b),c=c?/mac/.test(c):/mac/.test(b),b=/webkit/.test(b)?parseFloat(b.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,d=!+"\v1",g=[0,0,0],f=null;if("undefined"!=typeof E.plugins&&"object"==
typeof E.plugins["Shockwave Flash"])!(f=E.plugins["Shockwave Flash"].description)||"undefined"!=typeof E.mimeTypes&&E.mimeTypes["application/x-shockwave-flash"]&&!E.mimeTypes["application/x-shockwave-flash"].enabledPlugin||(B=!0,d=!1,f=f.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),g[0]=parseInt(f.replace(/^(.*)\..*$/,"$1"),10),g[1]=parseInt(f.replace(/^.*\.(.*)\s.*$/,"$1"),10),g[2]=/[a-zA-Z]/.test(f)?parseInt(f.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if("undefined"!=typeof z.ActiveXObject)try{var k=
new ActiveXObject("ShockwaveFlash.ShockwaveFlash");k&&(f=k.GetVariable("$version"))&&(d=!0,f=f.split(" ")[1].split(","),g=[parseInt(f[0],10),parseInt(f[1],10),parseInt(f[2],10)])}catch(h){}return{w3:a,pv:g,wk:b,ie:d,win:e,mac:c}}();(function(){l.w3&&(("undefined"!=typeof n.readyState&&"complete"==n.readyState||"undefined"==typeof n.readyState&&(n.getElementsByTagName("body")[0]||n.body))&&h(),H||("undefined"!=typeof n.addEventListener&&n.addEventListener("DOMContentLoaded",h,!1),l.ie&&l.win&&(n.attachEvent("onreadystatechange",
function(){"complete"==n.readyState&&(n.detachEvent("onreadystatechange",arguments.callee),h())}),z==top&&function(){if(!H){try{n.documentElement.doScroll("left")}catch(a){setTimeout(arguments.callee,0);return}h()}}()),l.wk&&function(){H||(/loaded|complete/.test(n.readyState)?h():setTimeout(arguments.callee,0))}(),f(h)))})();(function(){l.ie&&l.win&&window.attachEvent("onunload",function(){for(var a=K.length,b=0;b<a;b++)K[b][0].detachEvent(K[b][1],K[b][2]);a=y.length;for(b=0;b<a;b++)t(y[b]);for(var c in l)l[c]=
null;l=null;for(var e in C)C[e]=null;C=null})})();return{registerObject:function(a,b,c,e){if(l.w3&&a&&b){var d={};d.id=a;d.swfVersion=b;d.expressInstall=c;d.callbackFn=e;F[F.length]=d;v(a,!1)}else e&&e({success:!1,id:a})},getObjectById:function(a){if(l.w3)return c(a)},embedSWF:function(c,e,d,f,k,h,m,p,n,r){var t={success:!1,id:e};l.w3&&!(l.wk&&312>l.wk)&&c&&e&&d&&f&&k?(v(e,!1),a(function(){d+="";f+="";var a={};if(n&&"object"===typeof n)for(var l in n)a[l]=n[l];a.data=c;a.width=d;a.height=f;l={};if(p&&
"object"===typeof p)for(var I in p)l[I]=p[I];if(m&&"object"===typeof m)for(var u in m)l.flashvars="undefined"!=typeof l.flashvars?l.flashvars+("&"+u+"="+m[u]):u+"="+m[u];if(w(k))I=q(a,l,e),a.id==e&&v(e,!0),t.success=!0,t.ref=I;else{if(h&&g()){a.data=h;b(a,l,e,r);return}v(e,!0)}r&&r(t)})):r&&r(t)},switchOffAutoHideShow:function(){M=!1},ua:l,getFlashPlayerVersion:function(){return{major:l.pv[0],minor:l.pv[1],release:l.pv[2]}},hasFlashPlayerVersion:w,createSWF:function(a,b,c){if(l.w3)return q(a,b,c)},
showExpressInstall:function(a,c,e,d){l.w3&&g()&&b(a,c,e,d)},removeSWF:function(a){l.w3&&t(a)},createCSS:function(a,b,c,e){l.w3&&r(a,b,c,e)},addDomLoadEvent:a,addLoadEvent:f,getQueryParamValue:function(a){var b=n.location.search||n.location.hash;if(b){/\?/.test(b)&&(b=b.split("?")[1]);if(null==a)return A(b);for(var b=b.split("&"),c=0;c<b.length;c++)if(b[c].substring(0,b[c].indexOf("="))==a)return A(b[c].substring(b[c].indexOf("=")+1))}return""},expressInstallCallback:function(){if(N){var a=p("SWFObjectExprInst");
a&&L&&(a.parentNode.replaceChild(L,a),O&&(v(O,!0),l.ie&&l.win&&(L.style.display="block")),G&&G(J));N=!1}}}}();(function(){if(!window.WebSocket){var h=window.console;h&&h.log&&h.error||(h={log:function(){},error:function(){}});C.hasFlashPlayerVersion("10.0.0")?("file:"==location.protocol&&h.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),WebSocket=function(a,f,e,d,c){var g=this;g.__id=WebSocket.__nextId++;
WebSocket.__instances[g.__id]=g;g.readyState=WebSocket.CONNECTING;g.bufferedAmount=0;g.__events={};setTimeout(function(){WebSocket.__addTask(function(){WebSocket.__flash.create(g.__id,a,f,e||null,d||0,c||null)})},0)},WebSocket.prototype.send=function(a){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";a=WebSocket.__flash.send(this.__id,encodeURIComponent(a));if(0>a)return!0;this.bufferedAmount+=a;return!1},WebSocket.prototype.close=
function(){this.readyState!=WebSocket.CLOSED&&this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__addTask(function(){WebSocket.__flash.close(this.__id)}))},WebSocket.prototype.addEventListener=function(a,f,e){a in this.__events||(this.__events[a]=[]);this.__events[a].push(f)},WebSocket.prototype.removeEventListener=function(a,f,e){if(a in this.__events)for(a=this.__events[a],e=a.length-1;0<=e;--e)if(a[e]===f){a.splice(e,1);break}},WebSocket.prototype.dispatchEvent=function(a){for(var f=
this.__events[a.type]||[],e=0;e<f.length;++e)f[e](a);(f=this["on"+a.type])&&f(a)},WebSocket.prototype.__handleEvent=function(a){"readyState"in a&&(this.readyState=a.readyState);if("open"==a.type||"error"==a.type)a=this.__createSimpleEvent(a.type);else if("close"==a.type)a=this.__createSimpleEvent("close");else if("message"==a.type)a=decodeURIComponent(a.message),a=this.__createMessageEvent("message",a);else throw"unknown event type: "+a.type;this.dispatchEvent(a)},WebSocket.prototype.__createSimpleEvent=
function(a){if(document.createEvent&&window.Event){var f=document.createEvent("Event");f.initEvent(a,!1,!1);return f}return{type:a,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(a,f){if(document.createEvent&&window.MessageEvent&&!window.opera){var e=document.createEvent("MessageEvent");e.initMessageEvent("message",!1,!1,f,null,null,window,null);return e}return{type:a,data:f,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=
3,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(a){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(a)})},WebSocket.__initialize=function(){if(!WebSocket.__flash)if(document.body)if(WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),window.WEB_SOCKET_SWF_LOCATION){var a=document.createElement("div");a.id="webSocketContainer";a.style.position="absolute";WebSocket.__isFlashLite()?
(a.style.left="0px",a.style.top="0px"):(a.style.left="-100px",a.style.top="-100px");var f=document.createElement("div");f.id="webSocketFlash";a.appendChild(f);document.body.appendChild(a);C.embedSWF(J,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(a){a.success||h.error("[WebSocket] swfobject.embedSWF failed")})}else h.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");else window.addEventListener?
window.addEventListener("load",WebSocket.__initialize,!1):window.attachEvent("onload",WebSocket.__initialize)},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash");WebSocket.__flash.setCallerUrl(location.href);WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var a=0;a<WebSocket.__tasks.length;++a)WebSocket.__tasks[a]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){setTimeout(function(){try{for(var a=WebSocket.__flash.receiveEvents(),
f=0;f<a.length;++f)WebSocket.__instances[a[f].webSocketId].__handleEvent(a[f])}catch(e){h.error(e)}},0);return!0},WebSocket.__log=function(a){h.log(decodeURIComponent(a))},WebSocket.__error=function(a){h.error(decodeURIComponent(a))},WebSocket.__addTask=function(a){WebSocket.__flash?a():WebSocket.__tasks.push(a)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var a=window.navigator.mimeTypes["application/x-shockwave-flash"];return a&&a.enabledPlugin&&
a.enabledPlugin.filename?a.enabledPlugin.filename.match(/flashlite/i)?!0:!1:!1},window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||WebSocket.__initialize()):h.error("Flash Player >= 10.0.0 is required.")}})();(function(h){h.Twilio=h.Twilio||{};h.Twilio._phpjs_atob=function(a){var f,e,d,c,g,b=0,k=0;c="";var h=[];if(!a)return a;a+="";do f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(b++)),e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(b++)),
c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(b++)),g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(b++)),d=f<<18|e<<12|c<<6|g,f=d>>16&255,e=d>>8&255,d&=255,64==c?h[k++]=String.fromCharCode(f):64==g?h[k++]=String.fromCharCode(f,e):h[k++]=String.fromCharCode(f,e,d);while(b<a.length);c=h.join("");a=[];f=h=g=k=b=0;for(c+="";b<c.length;)g=c.charCodeAt(b),128>g?(a[k++]=String.fromCharCode(g),b++):191<g&&224>g?(h=c.charCodeAt(b+
1),a[k++]=String.fromCharCode((g&31)<<6|h&63),b+=2):(h=c.charCodeAt(b+1),f=c.charCodeAt(b+2),a[k++]=String.fromCharCode((g&15)<<12|(h&63)<<6|f&63),b+=3);return c=a.join("")};h.Twilio._phpjs_btoa=function(a){var f,e,d,c,g=0,b=0,k="",k=[];if(!a)return a;a+="";if(null===a||"undefined"===typeof a)a="";else{a+="";f="";e=d=c=0;c=a.length;for(var h=0;h<c;h++){var q=a.charCodeAt(h),t=null;128>q?d++:t=127<q&&2048>q?String.fromCharCode(q>>6|192)+String.fromCharCode(q&63|128):String.fromCharCode(q>>12|224)+
String.fromCharCode(q>>6&63|128)+String.fromCharCode(q&63|128);null!==t&&(d>e&&(f+=a.slice(e,d)),f+=t,e=d=h+1)}d>e&&(f+=a.slice(e,c));a=f}do f=a.charCodeAt(g++),e=a.charCodeAt(g++),d=a.charCodeAt(g++),c=f<<16|e<<8|d,f=c>>18&63,e=c>>12&63,d=c>>6&63,c&=63,k[b++]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(e)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c);
while(g<a.length);k=k.join("");switch(a.length%3){case 1:k=k.slice(0,-2)+"==";break;case 2:k=k.slice(0,-1)+"="}return k}})(window);(function(h){function a(e){if(!(this instanceof a))return new a(e);if("number"!=typeof e||1>e)return null;this.channels=1;this.bitdepth=16;this.samplerate=e;this.sine=[];for(var d=2*Math.PI/parseFloat(e),c=0;c<e;c++)this.sine.push(Math.sin(c*d))}var f={amplify:function(a){return function(d){return d*a}},ushort:function(a){return String.fromCharCode(255&a,255&a>>8)},ulong:function(a){return String.fromCharCode(255&
a,255&a>>8,255&a>>16,255&a>>24)},gcd:function(a,d){for(;d;){var c=a;a=d;d=c%d}return a},lcm:function(a,d){return Math.floor(a*d/f.gcd(a,d))},compose:function(a){return function(d){for(var c=0;c<a.length;c++)d=a[c](d);return d}},map:function(a,d){for(var c=[],f=0;f<d.length;f++)c.push(a.call(this,d[f]));return c},getattr:function(a){return function(d){return d[a]}},zip:function(){if(0==arguments.length)return[];for(var a=Array.prototype.slice.call(arguments),d=[],c=Math.min.apply(null,f.map(f.getattr("length"),
a)),g=0;g<c;g++)d.push(f.map(f.getattr(g),a));return d},sum:function(a){return f.foldl(function(a,c){return a+c},a)},bind:function(a,d){return function(){var c=Array.prototype.slice.call(arguments);return d.apply(a,c)}},foldl:function(a,d){if(1==d.length)return d[0];for(var c=a(d[0],d[1]),f=2;f<d.length;f++)c=a(c,d[f]);return c},mulmod:function(a,d,c){return a*d%c},range:function(a){for(var d=[],c=0;c<a;c++)d.push(c);return d}};a.prototype={generate:function(a){a=a instanceof Array?a:[a];var d=f.bind(this,
f.map),c=d(function(a){return f.lcm(this.samplerate,a)/a},a),c=f.foldl(f.lcm,c),g=function(a){return function(c){return this.sine[f.mulmod(a,c,this.samplerate)]}};return d(function(b){return f.sum(d(g(b),a))},f.range(c))},encode:function(e,d,c){e=e instanceof Array?e:[e];c=f.compose((c||[]).concat([f.ushort]));e=f.map(c,this.generate(e));c=Math.ceil(d*this.samplerate/e.length);e=Array(c+1).join(e.join("")).substr(0,this.samplerate*d*2);d=["fmt ",f.ulong(a.PCM_CHUNK_SIZE),f.ushort(a.LINEAR_QUANTIZATION),
f.ushort(this.channels),f.ulong(this.samplerate),f.ulong(this.samplerate*this.channels*this.bitdepth/8),f.ushort(this.bitdepth/8),f.ushort(this.bitdepth)].join("");e=["data",f.ulong(e.length*this.channels*this.bitdepth/8),e].join("");return[["RIFF",f.ulong(4+(8+d.length)+(8+e.length)),"WAVE"].join(""),d,e].join("")},play:function(a,d,c){c=c||[];a=btoa(this.encode(a,d,c));d=document.createElement("audio");d.src="data:audio/x-wav;base64,"+a;d.play()}};a.LINEAR_QUANTIZATION=1;a.PCM_CHUNK_SIZE=16;a.utils=
f;h.Beep=a})(window[window.NS_BEEP]||window);(function(h){function a(b){this.id=a.nextId++;a.items[this.id]=this;this.create()}var f={create:function(){this.audio=document.createElement("audio");this.playing=!1},buffer:function(){},play:function(a,c){if(!(this.playing||0>=c)){if(this.audio.currentTime!==a)try{if(this.audio.currentTime=a,this.audio.currentTime!==a)throw Error();}catch(d){var e=this.audio.src;this.audio.src="";this.audio.src=e}this.playing=!0;this.audio.play();var f=this;this.audio.addEventListener("ended",
function u(){f.audio.removeEventListener("ended",u,!1);f.playing?(f.playing=!1,f.play(a,c-1)):f.playing=!1},!1)}},load:function(a){this.audio.src=a},stop:function(){this.playing=!1},destroy:function(){this.audio.src="";delete this.audio}},e={create:function(){var b=this.id;a.queue(function(){a.flash.__create(b)})},buffer:function(b){var c=this.id;a.queue(function(){a.flash.__buffer(c,b)})},play:function(b,c){b=b||0;c=c||0;var d=this.id;a.queue(function(){a.flash.__play(d,b,c)})},load:function(b){var c=
this.id;a.queue(function(){a.flash.__load(c,b)})},stop:function(){var b=this.id;a.queue(function(){a.flash.__stop(b)})},destroy:function(){var b=this.id;a.queue(function(){a.flash.__destroy(b);delete a.items[b]})}},d={create:function(){},buffer:function(a){},play:function(a,c){},load:function(a){},stop:function(){},destroy:function(){}},c={initializeFlash:function(b){b=b||{};b.swfLocation=b.swfLocation||"SoundMain.swf";b.domId=b.domId||"__soundFlash__";if(!a.flash)if(document.body){var c=document.createElement("div");
c.id=b.domId;document.body.appendChild(c);a.flash=c;C.embedSWF(b.swfLocation,b.domId,"1","1","10.0.0",null,{namespace:"Twilio.Sound"},{hasPriority:!0,allowScriptAccess:"always"},null,function(b){a.log("Embed "+(b.success?"succeeded":"failed"))})}else try{window.addEventListener("load",function(){a.initializeFlash(b)},!1)}catch(d){window.attachEvent("onload",function(){a.initializeFlash(b)})}},log:function(b,c,d){if(a.debug&&window.console&&(d=d||"log",console[d]("[Sound] "+b),"undefined"!=typeof c))console[d](c)},
queue:function(b){a.initialized?b():a.tasks.push(b)}},g={__onFlashInitialized:function(){a.initialized=!0;a.flash=document.getElementById(a.flash.id);setTimeout(function(){a.flash.__setDebug(a.debug);a.log("Initialized and ready");for(var b=0;b<a.tasks.length;b++)a.tasks[b]()},0)},__onLog:function(b){a.log(b)}};a.nextId=0;a.debug=!1;a.tasks=[];a.items={};a.initialize=function(b){if(!b.forceFlash&&document.createElement("audio"))a.prototype=f;else if(C.hasFlashPlayerVersion("10.0.0")){a.prototype=
e;for(var k in c)a[k]=c[k];for(k in g)a[k]=g[k];a.initializeFlash(b)}else a.prototype=d,"undefined"!=typeof console&&(console.error||console.log||function(){})("WARNING: Audio sounds disabled. HTML5 audio support or Flash Player >= 10.0.0 is required")};h.Sound=a})(this.Twilio);(function(h){function a(b,c){this.__id=a.__nextId++;var d=function(){};this.onclose=this.onerror=this.onopen=d;this._uri=(b?"rtmps":"rtmp")+"://"+c+"/chunder";a.__instances[this.__id]=this}function f(a,c){if(document.body){var d=
document.createElement("div");d.style.position="absolute";d.appendChild(a);document.body.appendChild(d);c()}else{d=function(){f(a,c)};try{window.addEventListener("load",d,!1)}catch(e){window.attachEvent("onload",d)}}}var e=y("twilio/util");a.prototype={openHelper:function(b,c,d,e,f){a.__queue(function(){var g=a.getMicrophones().length==d;c?(!g&&a.isMicMuted()&&e(),b()):g?b("No microphone is available"):a.isMicMuted()?f(function(){a.isMicMuted()?b("User denied access to microphone.",31208):b()}):b()})},
uri:function(){return this._uri},open:function(){var b=this,c=Array.prototype.slice.call(arguments);a.__queue(function(){a.__flash.open.apply(a.__flash,[b.__id].concat(c))})},exec:function(){var b=this,c=Array.prototype.slice.call(arguments);a.__queue(function(){a.__flash.exec.apply(a.__flash,[b.__id].concat(c))})},close:function(){var b=this;a.__queue(function(){a.__flash.close(b.__id)})},play:function(){var b=this,c=Array.prototype.slice.call(arguments);a.__queue(function(){a.__flash.playStream.apply(a.__flash,
[b.__id].concat(c))})},publish:function(b,c){var d=this;a.__queue(function(){a.__flash.publish(d.__id,b,c)})},attachAudio:function(b){var c=this;a.__queue(function(){a.__flash.attachAudio(c.__id,b)})},detachAudio:function(){var b=this;a.__queue(function(){a.__flash.detachAudio(b.__id)})},__handleEvent:function(a){switch(a.type){case "gatewayError":case "securityError":case "asyncError":case "ioError":this.onerror.call(this,a);break;case "netStatus":this.__handleNetStatus(a)}},__handleNetStatus:function(b){a.log("Event info code: "+
b.info.code);switch(b.info.code){case "NetConnection.Connect.Failed":case "NetConnection.Connect.Rejected":a.log("Connection failed or was rejected");this.onerror.call(this,b);break;case "NetConnection.Connect.Closed":a.log("Connection closed");this.onclose.call(this,b);break;case "NetConnection.Connect.Success":a.log("Connection established");this.onopen.call(this);break;default:a.log("Unexpected event: "+b.info.code)}}};var d={__queue:function(b){a.initialized?b():a.__tasks.push(b)},initialize:function(b){if(!C.hasFlashPlayerVersion("10.0.0"))throw new e.Exception("Flash Player >= 10.0.0 is required.");
if(!a.__flash)if(b=b||{},b.swfLocation=b.swfLocation||"MediaStreamMain.swf",b.domId=b.domId||"__connectionFlash__",b.loader=b.loader||f,document.body){var c=document.createElement("div");c.id=b.domId;b.loader(c,function(){a.__flash=c;var d={};"objectEnc"in b&&(d.objectEnc=b.objectEnc);d.namespace="Twilio.MediaStream";C.embedSWF(b.swfLocation,b.domId,"215","138","10.0.0",null,d,{hasPriority:!0,allowScriptAccess:"always"},null,function(b){a.log("Embed "+(b.success?"succeeded":"failed"))})})}else try{window.addEventListener("load",
function(){a.initialize(b)},!1)}catch(d){window.attachEvent("onload",function(){a.initialize(b)})}},setMicrophoneGain:function(b){a.__queue(function(){try{a.__flash.setMicrophoneGain(b)}catch(c){a.log(c)}})},setMicrophone:function(b,c){a.__queue(function(){a.__flash.setMicrophone(b,c)})},getMicrophone:function(){return a.initialized?a.__flash.getMicrophone():null},getMicrophones:function(){return a.initialized?a.__flash.getMicrophones():[]},setUseEchoSuppression:function(b){a.__queue(function(){try{a.__flash.setUseEchoSupression(b)}catch(c){a.log(c)}})},
setSilenceLevel:function(b,c){a.__queue(function(){try{a.__flash.setSilenceLevel(b,c)}catch(d){a.log(d)}})},showSettings:function(){a.__queue(function(){a.__flash.showSettings()})},isMicMuted:function(){try{return a.__flash.isMicMuted()}catch(b){if(!(b instanceof TypeError))throw b;}},log:function(b,c,d){if(a.__debug&&window.console&&(d=d||"log",console[d]("[MediaStream] "+b),"undefined"!=typeof c))console[d](c)}},c={__onFlashInitialized:function(){a.__flash=document.getElementById(a.__flash.id);
setTimeout(function(){a.initialized=!0;a.__flash.setDebug(a.__debug);/Mac OS X.*Chrome\/2[34]/.test(navigator.userAgent)?a.setMicrophone(-1,!1):a.setMicrophone(-1,!0);var b=a.getMicrophone();a.log(b?"Using "+b:"No mics available");a.setMicrophoneGain(75);for(b=0;b<a.__tasks.length;b++)a.__tasks[b].call()},0)},__onMediaStreamEvent:function(){setTimeout(function(){for(var b=a.__flash.dequeueEvents(),c=0;c<b.length;c++)try{a.log("Received event: "+b[c].type),a.__instances[b[c].mediaStreamId].__handleEvent(b[c])}catch(d){a.log("Error while processing "+
b[c].type+": "+d.message,d,"error")}},0)},__onLog:function(b){"error"==b.level?a.log(b.message,void 0,"error"):a.log(b.message)}},g;for(g in d)a[g]=d[g];for(g in c)a[g]=c[g];a.__nextId=0;a.__flash=null;a.__instances={};a.__tasks=[];a.__debug=!1;a.initialized=!1;a.AMF0=0;a.AMF3=3;h.MediaStream=a})(this.Twilio);var A=document.createElement("audio"),M=!0;try{M=!(A.canPlayType&&A.canPlayType("audio/mpeg").replace(/no/,""))}catch(Q){}Twilio.Sound.initialize({swfLocation:B+"SoundMain.swf",forceFlash:M});
var G=y("twilio/device").Device;G.__afterSetup(function(h,a){if(!y("twilio/rtc").enabled()){var f=y("twilio/util").decode,e=y("twilio/factories").getClass("vendor/mediastream/mediastream","MediaStream");e.initialize({objectEnc:e.AMF0,swfLocation:function(a,c){if(!a)return c;var e=c.match(/^(\w+):\/\/([^/]*)(.*)?/);if(!e)return c;var b=e[1],h=e[2],e=e[3];if(!/twilio.com$/.test(h.split(":")[0]))return c;var m=f(a).iss;return m?b+"://"+m.toLowerCase()+"."+h+e:c}(h,B)+"MediaStreamMain.swf",loader:function(a,
c){G.dialog.insert(a,c)}})}});A=y("twilio");A.Sound=Twilio.Sound;A.MediaStream=Twilio.MediaStream;A._phpjs_atob=Twilio._phpjs_atob;A._phpjs_btoa=Twilio._phpjs_btoa;return A}());
